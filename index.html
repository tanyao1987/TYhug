<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‘¶å“¥ç¦åˆ©å¤œ</title>
    <style>
        :root { --primary: #a29bfe; --bg: #000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        body, html { width: 100%; height: 100%; background: #000; overflow: hidden; position: fixed; color: #fff; font-family: sans-serif; }
        #app-root { position: relative; width: 100%; height: 100%; overflow: hidden; background: #000; }
        #main-slider { position: absolute; width: 100%; height: 100%; top: 0; left: 0; will-change: transform; z-index: 1; }

        .slide-item { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; background: #000; overflow: hidden; }
        .prev-slide { transform: translateY(-100%); top: 0; }
        .curr-slide { transform: translateY(0); top: 0; }
        .next-slide { transform: translateY(100%); top: 0; }

        img, video { max-width: 100%; max-height: 100%; object-fit: contain; pointer-events: none; }

        /* éŸ³é¢‘æ§åˆ¶å°æ ·å¼ */
        .audio-card { width: 85%; max-width: 340px; background: rgba(255,255,255,0.08); backdrop-filter: blur(25px); border-radius: 40px; padding: 50px 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .audio-icon { font-size: 64px; margin-bottom: 20px; transition: 0.3s; }
        .is-playing .audio-icon { animation: bounce 1.2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .play-trigger { width: 80px; height: 80px; border-radius: 50%; background: var(--primary); border: none; font-size: 28px; cursor: pointer; color: #000; margin-top: 25px; transition: 0.2s; display: inline-flex; justify-content: center; align-items: center; }
        .play-trigger:active { transform: scale(0.9); }

        /* å¯¼èˆªæ  */
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,1) 40%, transparent); padding: 10px 0 35px 0; z-index: 999; }
        .scroll-container { display: flex; overflow-x: auto; white-space: nowrap; padding: 0 20px; gap: 12px; scrollbar-width: none; }
        .scroll-container::-webkit-scrollbar { display: none; }
        .nav-tab { display: inline-block; padding: 10px 20px; background: rgba(255,255,255,0.1); border-radius: 25px; font-size: 14px; color: #ccc; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); flex-shrink: 0; }
        .nav-tab.active { background: var(--primary); color: #000; font-weight: bold; border-color: var(--primary); }

        /* ä¾§è¾¹åŠŸèƒ½é”® */
        .side-bar { position: fixed; right: 15px; bottom: 140px; display: flex; flex-direction: column; gap: 18px; z-index: 1000; }
        .circle-btn { width: 52px; height: 52px; border-radius: 50%; background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; font-size: 24px; border: 1px solid rgba(255,255,255,0.15); cursor: pointer; }

        #start-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #start-mask button { padding: 18px 50px; border-radius: 40px; border: none; background: var(--primary); font-size: 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="start-mask">
    <button onclick="initApp()">å¼€å¯ç¦åˆ©æ¨¡å¼</button>
    <p style="color: #666; margin-top: 20px;">åˆ·åˆ·åˆ·,å°±çŸ¥é“åˆ·</p>
</div>

<div id="app-root">
    <div id="main-slider">
        <div class="slide-item prev-slide" id="slide-prev"></div>
        <div class="slide-item curr-slide" id="slide-curr"></div>
        <div class="slide-item next-slide" id="slide-next"></div>
    </div>

    <div class="side-bar">
        <div class="circle-btn" onclick="next()">ğŸ”„</div>
        <div class="circle-btn" onclick="toggleMute()" id="vol-icon">ğŸ”Š</div>
    </div>

    <div class="footer-nav">
        <div class="scroll-container" id="menu-list">
            <div class="nav-tab active" onclick="changeCate(this, 'https://v2.xxapi.cn/api/meinv', 'video')">ğŸ¬ éšæœºå°å§å§</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://api.pearktrue.cn/api/yujie/?type=mp3', 'audio')">ğŸ™ï¸ å¾¡å§éŸ³é¢‘</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/meinvpic', 'img')">ğŸ–¼ï¸ å°å§å§å›¾ç‰‡</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/heisi', 'img')">ğŸ–¤ éšæœºé»‘ä¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/baisi', 'img')">ğŸ¤ éšæœºç™½ä¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/jk', 'img')">ğŸ‘— éšæœºJK</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/random4kPic?type=wallpaper', 'img')">ğŸŒŸ 4Kå£çº¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/random4kPic?type=acg', 'img')">âœ¨ 4KäºŒæ¬¡å…ƒ</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=pc', 'img')">ğŸ’» PCåŠ¨æ¼«</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=wap', 'img')">ğŸ“± æ‰‹æœºåŠ¨æ¼«</div>
        </div>
    </div>
</div>

<script>
    let apiConfig = { url: 'https://v2.xxapi.cn/api/meinv', type: 'video' };
    let history = []; let curIdx = -1; let isMuted = false; let isAnimating = false;
    let isLoading = false; // å¹¶è¡Œé”

    const slider = document.getElementById('main-slider');
    const nodes = { prev: document.getElementById('slide-prev'), curr: document.getElementById('slide-curr'), next: document.getElementById('slide-next') };

    function initApp() { document.getElementById('start-mask').style.display = 'none'; next(); }

    function stopAllMedia() {
        document.querySelectorAll('video, audio').forEach(m => { m.pause(); m.src = ""; m.load(); m.remove(); });
    }

    function toggleAudio(btn) {
        const container = btn.closest('.audio-card');
        const audio = container.querySelector('audio');
        if (audio.paused) { audio.play(); btn.innerText = "â¸"; container.classList.add('is-playing'); } 
        else { audio.pause(); btn.innerText = "â–¶"; container.classList.remove('is-playing'); }
    }

    function createMedia(item, isActive) {
        if (!item) return '';
        if (item.type === 'video') {
            return `<video src="${item.url}" playsinline webkit-playsinline loop ${isActive?'autoplay':''} ${isMuted || !isActive ? 'muted' : ''}></video>`;
        } else if (item.type === 'audio') {
            const activeClass = isActive ? 'is-playing' : '';
            const icon = isActive ? 'â¸' : 'â–¶';
            return `
                <div class="audio-card ${activeClass}">
                    <div class="audio-icon">ğŸ™ï¸</div>
                    <p style="color:#aaa; font-size:14px;">å¾¡å§éŸ³æ’­æ”¾ä¸­</p>
                    <audio src="${item.url}" ${isActive?'autoplay':''} onended="this.parentElement.classList.remove('is-playing'); this.nextElementSibling.innerText='â–¶';"></audio>
                    <button class="play-trigger" onclick="toggleAudio(this)">${icon}</button>
                </div>`;
        } else {
            return `<img src="${item.url}">`;
        }
    }

    async function fetchOne() {
        try {
            const res = await fetch(apiConfig.url);
            const json = await res.json();
            const data = json.audiopath || (json.data ? (json.data.url || json.data) : null);
            return data ? { url: data, type: apiConfig.type } : null;
        } catch(e) { return null; }
    }

    // æ ¸å¿ƒæ”¹è¿›ï¼šæ·±åº¦å¹¶è¡Œé¢„å¡«è¡¥é€»è¾‘
    async function prefillHistory() {
        if (isLoading) return;
        isLoading = true;
        const targetLen = curIdx + 4; // å§‹ç»ˆç»´æŒé¢†å…ˆå½“å‰ 4 ä¸ªå†…å®¹
        
        while (history.length < targetLen) {
            // æ¯æ¬¡å¹¶è¡Œå‘èµ· 2 ä¸ªè¯·æ±‚
            const results = await Promise.all([fetchOne(), fetchOne()]);
            results.forEach(item => { if(item) history.push(item); });
        }
        isLoading = false;
        renderLayers();
    }

    function renderLayers() {
        // æ¸²æŸ“ä¸‹ä¸€å±‚ï¼ˆç§’å¼€çš„å…³é”®ï¼‰
        if (curIdx + 1 < history.length) nodes.next.innerHTML = createMedia(history[curIdx+1], false);
        // æ¸²æŸ“ä¸Šä¸€å±‚
        if (curIdx > 0) nodes.prev.innerHTML = createMedia(history[curIdx-1], false);
    }

    async function updateSlides() {
        stopAllMedia();
        nodes.curr.innerHTML = createMedia(history[curIdx], true);
        
        // å¼‚æ­¥å¹¶è¡Œé¢„è½½ï¼Œä¸é˜»å¡å½“å‰æ˜¾ç¤º
        prefillHistory();

        const v = nodes.curr.querySelector('video');
        if(v) { v.muted = isMuted; v.play().catch(()=>{}); }
    }

    function animateTo(direction) {
        if (isAnimating) return;
        isAnimating = true;
        const offset = direction === 'next' ? -100 : 100;
        slider.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.1, 0.25, 1)';
        slider.style.transform = `translateY(${offset}%)`;
        setTimeout(() => {
            if (direction === 'next') curIdx++; else curIdx--;
            updateSlides();
            slider.style.transition = 'none';
            slider.style.transform = 'translateY(0)';
            isAnimating = false;
        }, 400);
    }

    async function next() {
        if (curIdx === -1) {
            // é¦–æ¬¡è¿›å…¥ï¼šå¹¶è¡ŒåŠ è½½å‰ 3 ä¸ª
            const items = await Promise.all([fetchOne(), fetchOne(), fetchOne()]);
            items.forEach(it => { if(it) history.push(it); });
            if(history.length > 0) { curIdx = 0; updateSlides(); }
        } else {
            // å¦‚æœç‚¹å¤ªå¿«å‚¨å¤‡ä¸è¶³ï¼Œå¼ºåˆ¶æ‹‰å–ä¸€ä¸ª
            if (curIdx + 1 >= history.length) {
                const item = await fetchOne();
                if(item) { history.push(item); animateTo('next'); }
            } else animateTo('next');
        }
    }

    function prev() { if (curIdx > 0) animateTo('prev'); }

    function changeCate(el, api, type) {
        stopAllMedia();
        isAnimating = false; slider.style.transition = 'none'; slider.style.transform = 'translateY(0)';
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        apiConfig = { url: api, type: type };
        history = []; curIdx = -1;
        next();
        el.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }

    function toggleMute() {
        isMuted = !isMuted;
        document.getElementById('vol-icon').innerText = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        const m = nodes.curr.querySelector('video, audio');
        if(m) m.muted = isMuted;
    }

    let startY = 0, isMoving = false;
    const handleStart = (y) => { if(!isAnimating) { startY = y; slider.style.transition = 'none'; isMoving = true; } };
    const handleMove = (y) => { if(isMoving) { let d = y - startY; if(curIdx === 0 && d > 0) d /= 3; slider.style.transform = `translateY(${d}px)`; } };
    const handleEnd = (y) => {
        if(!isMoving) return; isMoving = false;
        let d = y - startY, h = window.innerHeight;
        if(d < -h*0.12) next(); else if(d > h*0.12 && curIdx > 0) prev();
        else { slider.style.transition = 'transform 0.2s ease-out'; slider.style.transform = 'translateY(0)'; }
    };

    window.addEventListener('wheel', e => {
        if(isAnimating || Math.abs(e.deltaY) < 30) return;
        if(e.deltaY > 0) next(); else prev();
    }, {passive: false});

    const zone = document.getElementById('app-root');
    zone.addEventListener('touchstart', e => handleStart(e.touches[0].clientY), {passive:true});
    zone.addEventListener('touchmove', e => handleMove(e.touches[0].clientY), {passive:true});
    zone.addEventListener('touchend', e => handleEnd(e.changedTouches[0].clientY), {passive:true});
    zone.addEventListener('mousedown', e => handleStart(e.clientY));
    window.addEventListener('mousemove', e => handleMove(e.clientY));
    window.addEventListener('mouseup', e => handleEnd(e.clientY));
</script>
</body>
</html>
