<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‘¶å“¥ç¦åˆ©é¡µ</title>
    <style>
        :root { --primary: #a29bfe; --bg: #000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        /* æ ¸å¿ƒï¼šé”å®šå…¨å±€ï¼Œç¦æ­¢ä»»ä½•é»˜è®¤æ»šåŠ¨ */
        body, html { 
            width: 100%; height: 100%; background: #000; 
            overflow: hidden; position: fixed; 
            color: #fff; font-family: sans-serif; 
        }

        /* ç‹¬ç«‹äºæ»‘åŠ¨å±‚çš„èƒŒæ™¯è§†å£ */
        #app-root {
            position: relative; width: 100%; height: 100%;
            overflow: hidden; background: #000;
        }

        /* æ»‘åŠ¨å®¹å™¨ï¼šåªå¤„ç†ä¸Šä¸‹ä½ç§» */
        #main-slider {
            position: absolute; width: 100%; height: 100%;
            top: 0; left: 0; will-change: transform; z-index: 1;
        }

        .slide-item {
            position: absolute; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            background: #000; overflow: hidden;
        }

        /* ä¸¥æ ¼çš„ä¸‰å±‚å¸ƒå±€ */
        .prev-slide { transform: translateY(-100%); top: 0; }
        .curr-slide { transform: translateY(0); top: 0; }
        .next-slide { transform: translateY(100%); top: 0; }

        img, video { max-width: 100%; max-height: 100%; object-fit: contain; pointer-events: none; }

        /* ç‹¬ç«‹å±‚ï¼šåº•éƒ¨å¯¼èˆªï¼Œç»ä¸å‚ä¸ä½ç§» */
        .footer-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,1) 40%, transparent);
            padding: 10px 0 35px 0; z-index: 999; 
        }
        .scroll-container { 
            display: flex; overflow-x: auto; white-space: nowrap; 
            padding: 0 20px; gap: 12px; scrollbar-width: none;
        }
        .scroll-container::-webkit-scrollbar { display: none; }
        .nav-tab {
            display: inline-block; padding: 10px 20px; background: rgba(255,255,255,0.1); 
            border-radius: 25px; font-size: 14px; color: #ccc; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.05); flex-shrink: 0;
        }
        .nav-tab.active { background: var(--primary); color: #000; font-weight: bold; border-color: var(--primary); }

        .side-bar { position: fixed; right: 15px; bottom: 140px; display: flex; flex-direction: column; gap: 18px; z-index: 1000; }
        .circle-btn { width: 50px; height: 50px; border-radius: 50%; background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; font-size: 24px; border: 1px solid rgba(255,255,255,0.15); cursor: pointer; }

        #start-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #start-mask button { padding: 18px 50px; border-radius: 40px; border: none; background: var(--primary); font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 10px 30px rgba(162,155,254,0.4); }
    </style>
</head>
<body>

<div id="start-mask">
    <button onclick="initApp()">å¼€å¯ç¦åˆ©æ¨¡å¼</button>
    <p style="color: #666; margin-top: 20px;">åˆ·æŠ–éŸ³ä¼šå§?</p>
</div>

<div id="app-root">
    <div id="main-slider">
        <div class="slide-item prev-slide" id="slide-prev"></div>
        <div class="slide-item curr-slide" id="slide-curr"></div>
        <div class="slide-item next-slide" id="slide-next"></div>
    </div>

    <div class="side-bar">
        <div class="circle-btn" onclick="next()">ğŸ”„</div>
        <div class="circle-btn" onclick="toggleMute()" id="vol-icon">ğŸ”Š</div>
    </div>

    <div class="footer-nav">
        <div class="scroll-container" id="menu-list">
            <div class="nav-tab active" onclick="changeCate(this, 'https://v2.xxapi.cn/api/meinv', 'video')">ğŸ¬ éšæœºå°å§å§</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/meinvpic', 'img')">ğŸ–¼ï¸ ç¾å¥³å›¾ç‰‡</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/heisi', 'img')">ğŸ–¤ éšæœºé»‘ä¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/baisi', 'img')">ğŸ¤ éšæœºç™½ä¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/jk', 'img')">ğŸ‘— éšæœºJK</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/random4kPic?type=wallpaper', 'img')">ğŸŒŸ 4Kå£çº¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/random4kPic?type=acg', 'img')">âœ¨ 4KäºŒæ¬¡å…ƒ</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=pc', 'img')">ğŸ’» PCåŠ¨æ¼«</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=wap', 'img')">ğŸ“± æ‰‹æœºåŠ¨æ¼«</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/head', 'img')">ğŸ‘¤ éšæœºå¤´åƒ</div>
        </div>
    </div>
</div>

<script>
    let apiConfig = { url: 'https://v2.xxapi.cn/api/meinv', type: 'video' };
    let history = []; 
    let curIdx = -1;
    let isMuted = false;
    let isAnimating = false;

    const slider = document.getElementById('main-slider');
    const nodes = {
        prev: document.getElementById('slide-prev'),
        curr: document.getElementById('slide-curr'),
        next: document.getElementById('slide-next')
    };

    function initApp() {
        document.getElementById('start-mask').style.display = 'none';
        next();
    }

    // å½»åº•é”€æ¯è§†é¢‘é˜²æ­¢æ®‹ç•™
    function stopVideos() {
        const videos = document.querySelectorAll('video');
        videos.forEach(v => {
            v.pause();
            v.muted = true;
            v.src = "";
            v.load();
            v.remove();
        });
    }

    function createMedia(item, isActive) {
        if (!item) return '';
        if (item.type === 'video') {
            const autoPlayAttr = isActive ? 'autoplay' : '';
            return `<video src="${item.url}" playsinline webkit-playsinline loop ${autoPlayAttr} ${isMuted || !isActive ? 'muted' : ''}></video>`;
        } else {
            return `<img src="${item.url}">`;
        }
    }

    async function fetchOne() {
        try {
            const res = await fetch(apiConfig.url);
            const json = await res.json();
            const data = json.data.url || json.data;
            return { url: data, type: apiConfig.type };
        } catch(e) { return null; }
    }

    async function updateSlides() {
        // å…ˆæ¸…ç†æ—§å†…å®¹
        nodes.curr.innerHTML = createMedia(history[curIdx], true);
        nodes.prev.innerHTML = curIdx > 0 ? createMedia(history[curIdx-1], false) : '';
        
        if (curIdx + 1 < history.length) {
            nodes.next.innerHTML = createMedia(history[curIdx+1], false);
        } else {
            nodes.next.innerHTML = '';
            fetchOne().then(item => {
                if(item) {
                    history.push(item);
                    nodes.next.innerHTML = createMedia(item, false);
                }
            });
        }
        
        const v = nodes.curr.querySelector('video');
        if(v) { v.muted = isMuted; v.play().catch(()=>{}); }
    }

    function animateTo(direction) {
        if (isAnimating) return;
        isAnimating = true;

        const offset = direction === 'next' ? -100 : 100;
        slider.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.1, 0.25, 1)';
        slider.style.transform = `translateY(${offset}%)`;

        setTimeout(() => {
            if (direction === 'next') curIdx++; else curIdx--;
            updateSlides();
            // å½’ä½
            slider.style.transition = 'none';
            slider.style.transform = 'translateY(0)';
            isAnimating = false;
        }, 400);
    }

    async function next() {
        if (curIdx === -1) {
            const item = await fetchOne();
            if(item) { history.push(item); curIdx = 0; updateSlides(); }
        } else {
            if (curIdx + 1 >= history.length) {
                const item = await fetchOne();
                if(item) { history.push(item); animateTo('next'); }
            } else animateTo('next');
        }
    }

    function prev() { if (curIdx > 0) animateTo('prev'); }

    // --- å¼ºåˆ¶ä¿®æ­£åˆ‡æ¢é€»è¾‘ ---
    function changeCate(el, api, type) {
        // 1. å¼ºåŠ›åœæ­¢
        stopVideos();
        // 2. ç‰©ç†é”å®šï¼šå¼ºåˆ¶ slider å›åˆ°åŸç‚¹ï¼Œä¸å¸¦ä»»ä½•å»¶è¿Ÿ
        isAnimating = false;
        slider.style.transition = 'none';
        slider.style.transform = 'translateY(0)';
        slider.style.top = '0'; 
        
        // 3. é‡ç½®çŠ¶æ€
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        apiConfig = { url: api, type: type };
        history = []; 
        curIdx = -1;
        
        // 4. åŠ è½½
        next();
        el.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }

    function toggleMute() {
        isMuted = !isMuted;
        document.getElementById('vol-icon').innerText = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        const v = nodes.curr.querySelector('video');
        if(v) v.muted = isMuted;
    }

    // --- ç»Ÿä¸€äº¤äº’ ---
    let startY = 0, isMoving = false;
    const handleStart = (y) => { if(!isAnimating) { startY = y; slider.style.transition = 'none'; isMoving = true; } };
    const handleMove = (y) => { if(isMoving) { let d = y - startY; if(curIdx === 0 && d > 0) d /= 3; slider.style.transform = `translateY(${d}px)`; } };
    const handleEnd = (y) => {
        if(!isMoving) return; isMoving = false;
        let d = y - startY, h = window.innerHeight;
        if(d < -h*0.1) next();
        else if(d > h*0.1 && curIdx > 0) prev();
        else { slider.style.transition = 'transform 0.2s ease-out'; slider.style.transform = 'translateY(0)'; }
    };

    window.addEventListener('wheel', e => {
        if(isAnimating || Math.abs(e.deltaY) < 20) return;
        if(e.deltaY > 0) next(); else prev();
    }, {passive: false});

    const zone = document.getElementById('app-root');
    zone.addEventListener('touchstart', e => handleStart(e.touches[0].clientY));
    zone.addEventListener('touchmove', e => handleMove(e.touches[0].clientY));
    zone.addEventListener('touchend', e => handleEnd(e.changedTouches[0].clientY));
    zone.addEventListener('mousedown', e => handleStart(e.clientY));
    window.addEventListener('mousemove', e => handleMove(e.clientY));
    window.addEventListener('mouseup', e => handleEnd(e.clientY));
</script>
</body>
</html>
