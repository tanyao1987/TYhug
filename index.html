<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æå®¢å…¨å±æµ - å…¨å¹³å°é€šç”¨ç‰ˆ</title>
    <style>
        :root { --primary: #a29bfe; --bg: #000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; color: #fff; font-family: sans-serif; }

        /* ä¸»å®¹å™¨ */
        .viewport { position: relative; width: 100%; height: 100%; overflow: hidden; touch-action: none; cursor: grab; }
        .viewport:active { cursor: grabbing; }

        #main-slider {
            width: 100%; height: 100%; position: absolute;
            will-change: transform; transition: transform 0s;
        }

        .slide-item {
            width: 100%; height: 100%; position: absolute;
            display: flex; justify-content: center; align-items: center;
            background: #000; overflow: hidden;
        }

        /* é¢„è®¾ä¸‰å±‚ä½ç½® */
        .prev-slide { transform: translateY(-100%); }
        .curr-slide { transform: translateY(0); }
        .next-slide { transform: translateY(100%); }

        img, video { max-width: 100%; max-height: 100%; object-fit: contain; pointer-events: none; }

        /* åº•éƒ¨å¯¼èˆª - å·¦å³æ»‘åŠ¨ */
        .footer-nav {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 10px 0 30px 0; z-index: 100;
        }
        .scroll-container { display: flex; overflow-x: auto; white-space: nowrap; padding: 0 20px; gap: 12px; scrollbar-width: none; }
        .scroll-container::-webkit-scrollbar { display: none; }
        .nav-tab {
            display: inline-block; padding: 8px 18px; background: rgba(255,255,255,0.1); 
            border-radius: 20px; font-size: 14px; color: #ccc; cursor: pointer; border: 1px solid rgba(255,255,255,0.05);
        }
        .nav-tab.active { background: var(--primary); color: #000; font-weight: bold; }

        /* å³ä¾§æ‚¬æµ®æ  */
        .side-bar { position: absolute; right: 20px; bottom: 130px; display: flex; flex-direction: column; gap: 15px; z-index: 101; }
        .circle-btn { width: 48px; height: 48px; border-radius: 50%; background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; font-size: 22px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; transition: 0.2s; }
        .circle-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }

        #start-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0c0c10; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #start-mask button { padding: 16px 45px; border-radius: 35px; border: none; background: var(--primary); font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #start-mask button:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--primary); }
    </style>
</head>
<body>

<div id="start-mask">
    <button onclick="initApp()">å¼€å¯å…¨å±æµ</button>
    <p style="color: #444; margin-top: 15px;">PC: æ»šè½®æˆ–æ‹–åŠ¨ / æ‰‹æœº: ä¸Šä¸‹æ»‘åŠ¨</p>
</div>

<div class="viewport" id="touch-zone">
    <div id="main-slider">
        <div class="slide-item prev-slide" id="slide-prev"></div>
        <div class="slide-item curr-slide" id="slide-curr"></div>
        <div class="slide-item next-slide" id="slide-next"></div>
    </div>

    <div class="side-bar">
        <div class="circle-btn" onclick="next()">ğŸ”„</div>
        <div class="circle-btn" onclick="toggleMute()" id="vol-icon">ğŸ”Š</div>
    </div>

    <div class="footer-nav">
        <div class="scroll-container" id="menu-list">
            <div class="nav-tab active" onclick="changeCate(this, 'https://v2.xxapi.cn/api/meinv', 'video')">ğŸ¬ éšæœºå°å§å§</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/meinvpic', 'img')">ğŸ–¼ï¸ ç¾å¥³å›¾ç‰‡</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/heisi', 'img')">ğŸ–¤ éšæœºé»‘ä¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/baisi', 'img')">ğŸ¤ éšæœºç™½ä¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/jk', 'img')">ğŸ‘— éšæœºJK</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/random4kPic?type=wallpaper', 'img')">ğŸŒŸ 4Kå£çº¸</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/random4kPic?type=acg', 'img')">âœ¨ 4KäºŒæ¬¡å…ƒ</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=pc', 'img')">ğŸ’» PCåŠ¨æ¼«</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=wap', 'img')">ğŸ“± æ‰‹æœºåŠ¨æ¼«</div>
            <div class="nav-tab" onclick="changeCate(this, 'https://v2.xxapi.cn/api/head', 'img')">ğŸ‘¤ éšæœºå¤´åƒ</div>
        </div>
    </div>
</div>

<script>
    let apiConfig = { url: 'https://v2.xxapi.cn/api/meinv', type: 'video' };
    let history = []; 
    let curIdx = -1;
    let isMuted = false;
    let isAnimating = false; // å¢åŠ é”ï¼Œé˜²æ­¢é¢‘ç¹æ»šåŠ¨å¯¼è‡´é‡å 

    const slider = document.getElementById('main-slider');
    const nodes = {
        prev: document.getElementById('slide-prev'),
        curr: document.getElementById('slide-curr'),
        next: document.getElementById('slide-next')
    };

    function initApp() {
        document.getElementById('start-mask').style.display = 'none';
        next();
    }

    function createMedia(item, isActive) {
        if (!item) return '';
        if (item.type === 'video') {
            const autoPlayAttr = isActive ? 'autoplay' : '';
            return `<video src="${item.url}" playsinline webkit-playsinline loop ${autoPlayAttr} ${isMuted || !isActive ? 'muted' : ''}></video>`;
        } else {
            return `<img src="${item.url}">`;
        }
    }

    function stopVideos() {
        document.querySelectorAll('video').forEach(v => {
            v.pause();
            v.muted = true;
        });
    }

    async function fetchOne() {
        try {
            const res = await fetch(apiConfig.url);
            const json = await res.json();
            return { url: json.data.url || json.data, type: apiConfig.type };
        } catch(e) { return null; }
    }

    async function updateSlides() {
        stopVideos();
        nodes.curr.innerHTML = createMedia(history[curIdx], true);
        nodes.prev.innerHTML = curIdx > 0 ? createMedia(history[curIdx-1], false) : '';
        
        if (curIdx + 1 < history.length) {
            nodes.next.innerHTML = createMedia(history[curIdx+1], false);
        } else {
            nodes.next.innerHTML = '';
            fetchOne().then(item => {
                if(item) {
                    history.push(item);
                    nodes.next.innerHTML = createMedia(item, false);
                }
            });
        }

        const activeVideo = nodes.curr.querySelector('video');
        if (activeVideo) {
            activeVideo.muted = isMuted;
            activeVideo.play().catch(e => {});
        }
    }

    // --- å¸¦åŠ¨ç”»çš„ç¿»é¡µå°è£… ---
    function animateTo(direction) {
        if (isAnimating) return;
        isAnimating = true;

        const offset = direction === 'next' ? -100 : 100;
        slider.style.transition = 'transform 0.4s cubic-bezier(0.1, 0.67, 0.48, 1)';
        slider.style.transform = `translateY(${offset}%)`;

        setTimeout(() => {
            if (direction === 'next') {
                curIdx++;
                if (curIdx >= history.length) {
                    fetchOne().then(item => {
                        if(item) { history.push(item); updateSlides(); }
                        else { curIdx--; }
                    });
                } else { updateSlides(); }
            } else {
                curIdx--;
                updateSlides();
            }
            slider.style.transition = 'none';
            slider.style.transform = 'translateY(0)';
            isAnimating = false;
        }, 400);
    }

    async function next() {
        if (curIdx === -1) { // é¦–æ¬¡åŠ è½½ä¸éœ€è¦åŠ¨ç”»
            const item = await fetchOne();
            if(item) { history.push(item); curIdx = 0; updateSlides(); }
        } else {
            animateTo('next');
        }
    }

    function prev() {
        if (curIdx > 0) animateTo('prev');
    }

    function changeCate(el, api, type) {
        stopVideos();
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        apiConfig = { url: api, type: type };
        history = []; curIdx = -1;
        next();
        el.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }

    function toggleMute() {
        isMuted = !isMuted;
        document.getElementById('vol-icon').innerText = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        const v = nodes.curr.querySelector('video');
        if(v) v.muted = isMuted;
    }

    // --- PC æ»šè½®ç›‘å¬ ---
    let lastWheelTime = 0;
    window.addEventListener('wheel', e => {
        const now = Date.now();
        if (now - lastWheelTime < 800) return; // é˜²æŠ–ï¼Œé¿å…æ»šè½®å¤ªçµæ•ä¸€ä¸‹è·³å¥½å‡ å¼ 

        if (e.deltaY > 50) {
            next();
            lastWheelTime = now;
        } else if (e.deltaY < -50) {
            prev();
            lastWheelTime = now;
        }
    }, {passive: false});

    // --- ç»Ÿä¸€æ‰‹åŠ¿é€»è¾‘ (å…¼å®¹ Mouse å’Œ Touch) ---
    let startY = 0;
    let isMoving = false;

    const handleStart = (y) => {
        if (isAnimating) return;
        startY = y;
        slider.style.transition = 'none';
        isMoving = true;
    };

    const handleMove = (y) => {
        if (!isMoving) return;
        let deltaY = y - startY;
        if (curIdx === 0 && deltaY > 0) deltaY /= 3;
        slider.style.transform = `translateY(${deltaY}px)`;
    };

    const handleEnd = (y) => {
        if (!isMoving) return;
        isMoving = false;
        let deltaY = y - startY;
        const screenH = window.innerHeight;

        if (deltaY < -screenH * 0.15) {
            animateTo('next');
        } else if (deltaY > screenH * 0.15 && curIdx > 0) {
            animateTo('prev');
        } else {
            slider.style.transition = 'transform 0.2s ease-out';
            slider.style.transform = 'translateY(0)';
        }
    };

    // ç»‘å®šè§¦æ‘¸
    const zone = document.getElementById('touch-zone');
    zone.addEventListener('touchstart', e => handleStart(e.touches[0].clientY), {passive:true});
    zone.addEventListener('touchmove', e => handleMove(e.touches[0].clientY), {passive:true});
    zone.addEventListener('touchend', e => handleEnd(e.changedTouches[0].clientY), {passive:true});

    // ç»‘å®šé¼ æ ‡æ‹–åŠ¨
    zone.addEventListener('mousedown', e => handleStart(e.clientY));
    window.addEventListener('mousemove', e => handleMove(e.clientY));
    window.addEventListener('mouseup', e => handleEnd(e.clientY));

</script>
</body>
</html>
