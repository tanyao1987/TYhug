<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æå®¢å·¥å…·ç®± - æµç•…ç‰ˆ</title>
    <style>
        :root {
            --primary: #a29bfe;
            --accent: #ff7675;
            --bg: #0c0c10;
            --side: #16161e;
            --input-bg: #252530;
        }
        body {
            margin: 0; display: flex; height: 100vh;
            background: var(--bg); color: #eee;
            font-family: system-ui, -apple-system, sans-serif; overflow: hidden;
        }

        /* ä¾§è¾¹æ  H5 é€‚é… */
        .sidebar {
            width: 280px; background: var(--side); padding: 20px 15px;
            overflow-y: auto; border-right: 1px solid #2d2d3f; flex-shrink: 0;
        }
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: 40%; order: 2; border-right: none; border-top: 1px solid #333; }
            .main { height: 60%; order: 1; }
        }

        .sidebar h2 { font-size: 1.4rem; text-align: center; color: var(--primary); margin-bottom: 20px; }
        .tool-panel { background: var(--input-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; }
        .douyin-panel textarea { width: 100%; height: 60px; background: #111; border: 1px solid #444; color: #ccc; border-radius: 6px; padding: 8px; font-size: 12px; resize: none; box-sizing: border-box; outline: none; }
        .douyin-panel button { width: 100%; margin-top: 10px; background: #fe2c55; border: none; padding: 10px; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* ä¸‹è½½æŒ‰é’®æ ·å¼ */
        .download-btn { background: #00b894 !important; display: none; margin-top: 8px; }

        .group-title { font-size: 11px; color: #555; margin: 18px 0 8px 5px; letter-spacing: 2px; text-transform: uppercase; border-left: 2px solid var(--primary); padding-left: 8px; }
        .sidebar button { width: 100%; padding: 12px; margin-bottom: 6px; border: none; border-radius: 8px; background: rgba(255,255,255,0.03); color: #bbb; cursor: pointer; text-align: left; transition: 0.2s; font-size: 14px; }
        .sidebar button:hover { background: rgba(255,255,255,0.08); color: #fff; }
        .sidebar button.active { background: var(--primary); color: #000; font-weight: bold; }

        .main { flex-grow: 1; position: relative; background: #000; display: flex; justify-content: center; align-items: center; }
        .media-container { width: 100%; height: 100%; display: none; justify-content: center; align-items: center; cursor: pointer; }

        #video-title {
            position: absolute; top: 20px; padding: 10px 20px; color: white;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            border-radius: 20px; font-size: 13px; z-index: 20; display: none;
            border: 1px solid rgba(255,255,255,0.1); text-align: center; max-width: 80%;
        }

        .fade-in { animation: fadeIn 0.4s ease-in forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        img, video { max-width: 98%; max-height: 98%; object-fit: contain; display: none; }

        .loading-spinner {
            position: absolute; width: 45px; height: 45px;
            border: 4px solid rgba(162, 155, 254, 0.1); border-top: 4px solid var(--primary);
            border-radius: 50%; animation: spin 0.8s linear infinite; display: none; z-index: 100;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #welcome-view { text-align: center; color: #555; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>TOOLBOX</h2>
    <div class="tool-panel douyin-panel">
        <div class="group-title" style="color:#fe2c55; margin-top:0; border-left-color:#fe2c55;">æŠ–éŸ³è§£æ</div>
        <textarea id="dy-input" placeholder="ç²˜è´´é“¾æ¥..."></textarea>
        <button onclick="parseDouyin()">ç«‹å³è§£æ</button>
        <button id="download-node" class="download-btn" onclick="saveVideo()">ä¿å­˜åˆ°ç›¸å†Œ</button>
    </div>

    <div class="group-title">è§†é¢‘å¨±ä¹</div>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/meinv', 'video')">ğŸ¬ éšæœºå°å§å§è§†é¢‘</button>
    <div class="group-title">ç¾å›¾åˆ†ç±»</div>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/meinvpic', 'img')">ğŸ–¼ï¸ å°å§å§å›¾ç‰‡</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/heisi', 'img')">ğŸ–¤ éšæœºé»‘ä¸</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/baisi', 'img')">ğŸ¤ éšæœºç™½ä¸</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/jk', 'img')">ğŸ‘— éšæœºJK</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=pc', 'img')">ğŸ’» PCäºŒæ¬¡å…ƒ</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/randomAcgPic?type=wap', 'img')">ğŸ“± æ‰‹æœºäºŒæ¬¡å…ƒ</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/random4kPic?type=wallpaper', 'img')">ğŸŒŸ 4Kéšæœºå£çº¸</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/random4kPic?type=acg', 'img')">âœ¨ 4KäºŒæ¬¡å…ƒ</button>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/wallpaper', 'img')">ğŸ–¼ï¸ é€šç”¨å£çº¸</button>
    <div class="group-title">ç”Ÿæ´»è¾…åŠ©</div>
    <button onclick="fetchApi(this, 'https://v2.xxapi.cn/api/head', 'img')">ğŸ‘¤ éšæœºå¤´åƒ</button>
</div>

<div class="main">
    <div id="welcome-view"><i>ğŸ› ï¸</i><p>è¯·é€‰æ‹©å·¥å…·</p></div>
    <div id="loader" class="loading-spinner"></div>
    <div id="video-title"></div>
    <div id="display-zone" class="media-container" onclick="handleContainerClick()">
        <img id="img-node">
        <video id="video-node" controls autoplay loop playsinline webkit-playsinline></video>
    </div>
</div>

<script>
    let activeApi = '', activeType = '', isDouyinMode = false;
    let lastDownloadUrl = ''; // æ–°å¢ï¼šè®°å½•æœ€åä¸€æ¬¡è§£ææˆåŠŸçš„URL

    const imgNode = document.getElementById('img-node');
    const videoNode = document.getElementById('video-node');
    const loader = document.getElementById('loader');
    const titleNode = document.getElementById('video-title');
    const welcomeView = document.getElementById('welcome-view');
    const displayZone = document.getElementById('display-zone');
    const downloadNode = document.getElementById('download-node');

    imgNode.onload = function() {
        loader.style.display = 'none';
        this.style.display = 'block';
        this.classList.add('fade-in');
    };

    videoNode.oncanplay = function() {
        loader.style.display = 'none';
        this.style.display = 'block';
        this.classList.add('fade-in');
    };

    async function fetchApi(btn, url, type) {
        welcomeView.style.display = 'none';
        displayZone.style.display = 'flex';
        isDouyinMode = false;
        titleNode.style.display = 'none';
        downloadNode.style.display = 'none'; // åˆ‡æ¢åˆ°éæŠ–éŸ³æ¨¡å¼éšè—ä¸‹è½½

        document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');

        activeApi = url;
        activeType = type;
        refresh();
    }

    async function refresh() {
        if (!activeApi) return;
        resetDisplay();
        loader.style.display = 'block';

        try {
            const res = await fetch(activeApi);
            const json = await res.json();
            if (json.code === 200) {
                if (activeType === 'video') {
                    videoNode.src = json.data;
                } else {
                    imgNode.src = json.data;
                }
            } else {
                loader.style.display = 'none';
                alert("æ¥å£è¿”å›é”™è¯¯");
            }
        } catch (e) {
            loader.style.display = 'none';
            alert("è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•");
        }
    }

    function resetDisplay() {
        imgNode.style.display = 'none';
        imgNode.classList.remove('fade-in');
        imgNode.src = '';

        videoNode.style.display = 'none';
        videoNode.classList.remove('fade-in');
        videoNode.pause();
        videoNode.src = '';
    }

    /* æŠ–éŸ³è§£æé€»è¾‘ï¼š100% è¿˜åŸä½ çš„åŸå§‹ä»£ç  */
    async function parseDouyin() {
        const text = document.getElementById('dy-input').value;
        // å®Œå…¨ä¿æŒä½ çš„åŸå§‹æ­£åˆ™
        const urlMatch = text.match(/https?:\/\/[v\d]+\.douyin\.com\/[A-Za-z0-9\-\/]+/);

        if (!urlMatch) {
            alert("æœªè¯†åˆ«åˆ°æŠ–éŸ³é“¾æ¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®");
            return;
        }

        const cleanUrl = urlMatch[0];

        welcomeView.style.display = 'none';
        displayZone.style.display = 'flex';
        isDouyinMode = true;
        resetDisplay();
        loader.style.display = 'block';
        downloadNode.style.display = 'none';

        try {
            const res = await fetch(`https://ysjger1987-douyin.hf.space/?url=${encodeURIComponent(cleanUrl)}`);
            const json = await res.json();
            if (json.code === 200) {
                titleNode.innerText = json.data.title;
                titleNode.style.display = 'block';
                activeType = 'video';
                videoNode.src = json.data.url;
                
                // è®°å½•åœ°å€å¹¶æ˜¾ç¤ºä¿å­˜æŒ‰é’®
                lastDownloadUrl = json.data.url;
                downloadNode.style.display = 'block';
            } else {
                throw new Error(json.msg || "è§£æå¤±è´¥");
            }
        } catch (e) {
            loader.style.display = 'none';
            alert("è§£æå¤±è´¥: " + e.message);
        }
    }

    // æ–°å¢ä¿å­˜åŠŸèƒ½ï¼šä¸å½±å“åŸæœ‰é€»è¾‘
    function saveVideo() {
        if (!lastDownloadUrl) return;
        const a = document.createElement('a');
        a.href = lastDownloadUrl;
        a.download = 'video_' + Date.now() + '.mp4';
        a.target = '_blank'; // å…¼å®¹æ‰‹æœºç«¯è·³è½¬
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        alert('è¯·åœ¨æ‰“å¼€çš„é¡µé¢é•¿æŒ‰è§†é¢‘é€‰æ‹©â€œä¿å­˜è§†é¢‘â€');
    }

    function handleContainerClick() {
        if (!isDouyinMode) refresh();
    }
</script>
</body>
</html>


